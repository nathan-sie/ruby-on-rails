{"ast":null,"code":"import { ref, computed } from 'vue';\n\nfunction useAllowCreate(props, states) {\n  var createOptionCount = ref(0);\n  var cachedSelectedOption = ref(null);\n  var enableAllowCreateMode = computed(function () {\n    return props.allowCreate && props.filterable;\n  });\n\n  function hasExistingOption(query) {\n    var hasValue = function hasValue(option) {\n      return option.value === query;\n    };\n\n    return props.options && props.options.some(hasValue) || states.createdOptions.some(hasValue);\n  }\n\n  function selectNewOption(option) {\n    if (!enableAllowCreateMode.value) {\n      return;\n    }\n\n    if (props.multiple && option.created) {\n      createOptionCount.value++;\n    } else {\n      cachedSelectedOption.value = option;\n    }\n  }\n\n  function createNewOption(query) {\n    if (enableAllowCreateMode.value) {\n      if (query && query.length > 0 && !hasExistingOption(query)) {\n        var newOption = {\n          value: query,\n          label: query,\n          created: true,\n          disabled: false\n        };\n\n        if (states.createdOptions.length >= createOptionCount.value) {\n          states.createdOptions[createOptionCount.value] = newOption;\n        } else {\n          states.createdOptions.push(newOption);\n        }\n      } else {\n        if (props.multiple) {\n          states.createdOptions.length = createOptionCount.value;\n        } else {\n          var selectedOption = cachedSelectedOption.value;\n          states.createdOptions.length = 0;\n\n          if (selectedOption && selectedOption.created) {\n            states.createdOptions.push(selectedOption);\n          }\n        }\n      }\n    }\n  }\n\n  function removeNewOption(option) {\n    if (!enableAllowCreateMode.value || !option || !option.created) {\n      return;\n    }\n\n    var idx = states.createdOptions.findIndex(function (it) {\n      return it.value === option.value;\n    });\n\n    if (~idx) {\n      states.createdOptions.splice(idx, 1);\n      createOptionCount.value--;\n    }\n  }\n\n  function clearAllNewOption() {\n    if (enableAllowCreateMode.value) {\n      states.createdOptions.length = 0;\n      createOptionCount.value = 0;\n    }\n  }\n\n  return {\n    createNewOption: createNewOption,\n    removeNewOption: removeNewOption,\n    selectNewOption: selectNewOption,\n    clearAllNewOption: clearAllNewOption\n  };\n}\n\nexport { useAllowCreate };","map":null,"metadata":{},"sourceType":"module"}