{"ast":null,"code":"function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { defineComponent, ref, reactive, computed, unref, watch, onMounted, onBeforeUnmount, h, withModifiers } from 'vue';\nimport '../../../scrollbar/index.mjs';\nimport { on, off } from '../../../../utils/dom.mjs';\nimport { cAF, rAF } from '../../../../utils/raf.mjs';\nimport isServer from '../../../../utils/isServer.mjs';\nimport { HORIZONTAL, ScrollbarDirKey, SCROLLBAR_MIN_SIZE } from '../defaults.mjs';\nimport { virtualizedScrollbarProps } from '../props.mjs';\nimport { renderThumbStyle } from '../utils.mjs';\nimport { BAR_MAP } from '../../../scrollbar/src/util.mjs';\nvar ScrollBar = defineComponent({\n  name: \"ElVirtualScrollBar\",\n  props: virtualizedScrollbarProps,\n  emits: [\"scroll\", \"start-move\", \"stop-move\"],\n  setup: function setup(props, _ref) {\n    var emit = _ref.emit;\n    var GAP = 4;\n    var trackRef = ref();\n    var thumbRef = ref();\n    var frameHandle = null;\n    var onselectstartStore = null;\n    var state = reactive({\n      isDragging: false,\n      traveled: 0\n    });\n    var bar = computed(function () {\n      return BAR_MAP[props.layout];\n    });\n    var trackSize = computed(function () {\n      return props.clientSize - GAP;\n    });\n    var trackStyle = computed(function () {\n      var _ref2;\n\n      return _ref2 = {\n        position: \"absolute\",\n        width: HORIZONTAL === props.layout ? \"\".concat(trackSize.value, \"px\") : \"6px\",\n        height: HORIZONTAL === props.layout ? \"6px\" : \"\".concat(trackSize.value, \"px\")\n      }, _defineProperty(_ref2, ScrollbarDirKey[props.layout], \"2px\"), _defineProperty(_ref2, \"right\", \"2px\"), _defineProperty(_ref2, \"bottom\", \"2px\"), _defineProperty(_ref2, \"borderRadius\", \"4px\"), _ref2;\n    });\n    var thumbSize = computed(function () {\n      var ratio = props.ratio;\n      var clientSize = props.clientSize;\n\n      if (ratio >= 100) {\n        return Number.POSITIVE_INFINITY;\n      }\n\n      if (ratio >= 50) {\n        return ratio * clientSize / 100;\n      }\n\n      var SCROLLBAR_MAX_SIZE = clientSize / 3;\n      return Math.floor(Math.min(Math.max(ratio * clientSize, SCROLLBAR_MIN_SIZE), SCROLLBAR_MAX_SIZE));\n    });\n    var thumbStyle = computed(function () {\n      if (!Number.isFinite(thumbSize.value)) {\n        return {\n          display: \"none\"\n        };\n      }\n\n      var thumb = \"\".concat(thumbSize.value, \"px\");\n      var style = renderThumbStyle({\n        bar: bar.value,\n        size: thumb,\n        move: state.traveled\n      }, props.layout);\n      return style;\n    });\n    var totalSteps = computed(function () {\n      return Math.floor(props.clientSize - thumbSize.value - GAP);\n    });\n\n    var attachEvents = function attachEvents() {\n      on(window, \"mousemove\", onMouseMove);\n      on(window, \"mouseup\", onMouseUp);\n      var thumbEl = unref(thumbRef);\n      if (!thumbEl) return;\n      onselectstartStore = document.onselectstart;\n\n      document.onselectstart = function () {\n        return false;\n      };\n\n      on(thumbEl, \"touchmove\", onMouseMove);\n      on(thumbEl, \"touchend\", onMouseUp);\n    };\n\n    var detachEvents = function detachEvents() {\n      off(window, \"mousemove\", onMouseMove);\n      off(window, \"mouseup\", onMouseUp);\n      document.onselectstart = onselectstartStore;\n      onselectstartStore = null;\n      var thumbEl = unref(thumbRef);\n      if (!thumbEl) return;\n      off(thumbEl, \"touchmove\", onMouseMove);\n      off(thumbEl, \"touchend\", onMouseUp);\n    };\n\n    var onThumbMouseDown = function onThumbMouseDown(e) {\n      e.stopImmediatePropagation();\n\n      if (e.ctrlKey || [1, 2].includes(e.button)) {\n        return;\n      }\n\n      state.isDragging = true;\n      state[bar.value.axis] = e.currentTarget[bar.value.offset] - (e[bar.value.client] - e.currentTarget.getBoundingClientRect()[bar.value.direction]);\n      emit(\"start-move\");\n      attachEvents();\n    };\n\n    var onMouseUp = function onMouseUp() {\n      state.isDragging = false;\n      state[bar.value.axis] = 0;\n      emit(\"stop-move\");\n      detachEvents();\n    };\n\n    var onMouseMove = function onMouseMove(e) {\n      var isDragging = state.isDragging;\n      if (!isDragging) return;\n      if (!thumbRef.value || !trackRef.value) return;\n      var prevPage = state[bar.value.axis];\n      if (!prevPage) return;\n      cAF(frameHandle);\n      var offset = (trackRef.value.getBoundingClientRect()[bar.value.direction] - e[bar.value.client]) * -1;\n      var thumbClickPosition = thumbRef.value[bar.value.offset] - prevPage;\n      var distance = offset - thumbClickPosition;\n      frameHandle = rAF(function () {\n        state.traveled = Math.max(0, Math.min(distance, totalSteps.value));\n        emit(\"scroll\", distance, totalSteps.value);\n      });\n    };\n\n    var clickTrackHandler = function clickTrackHandler(e) {\n      var offset = Math.abs(e.target.getBoundingClientRect()[bar.value.direction] - e[bar.value.client]);\n      var thumbHalf = thumbRef.value[bar.value.offset] / 2;\n      var distance = offset - thumbHalf;\n      state.traveled = Math.max(0, Math.min(distance, totalSteps.value));\n      emit(\"scroll\", distance, totalSteps.value);\n    };\n\n    var onScrollbarTouchStart = function onScrollbarTouchStart(e) {\n      return e.preventDefault();\n    };\n\n    watch(function () {\n      return props.scrollFrom;\n    }, function (v) {\n      if (state.isDragging) return;\n      state.traveled = Math.ceil(v * totalSteps.value);\n    });\n    onMounted(function () {\n      if (isServer) return;\n      on(trackRef.value, \"touchstart\", onScrollbarTouchStart);\n      on(thumbRef.value, \"touchstart\", onThumbMouseDown);\n    });\n    onBeforeUnmount(function () {\n      off(trackRef.value, \"touchstart\", onScrollbarTouchStart);\n      detachEvents();\n    });\n    return function () {\n      return h(\"div\", {\n        role: \"presentation\",\n        ref: trackRef,\n        \"class\": \"el-virtual-scrollbar\",\n        style: trackStyle.value,\n        onMousedown: withModifiers(clickTrackHandler, [\"stop\", \"prevent\"])\n      }, h(\"div\", {\n        ref: thumbRef,\n        \"class\": \"el-scrollbar__thumb\",\n        style: thumbStyle.value,\n        onMousedown: onThumbMouseDown\n      }, []));\n    };\n  }\n});\nexport { ScrollBar as default };","map":null,"metadata":{},"sourceType":"module"}