{"ast":null,"code":"import { inject, computed, ref } from 'vue';\nimport { useGlobalConfig, generateId } from '../../../utils/util.mjs';\nimport { EVENT_CODE } from '../../../utils/aria.mjs';\nimport { addClass, on } from '../../../utils/dom.mjs';\n\nvar useDropdown = function useDropdown() {\n  var ELEMENT = useGlobalConfig();\n  var elDropdown = inject(\"elDropdown\", {});\n\n  var _elDropdownSize = computed(function () {\n    return elDropdown == null ? void 0 : elDropdown.dropdownSize;\n  });\n\n  return {\n    ELEMENT: ELEMENT,\n    elDropdown: elDropdown,\n    _elDropdownSize: _elDropdownSize\n  };\n};\n\nvar initDropdownDomEvent = function initDropdownDomEvent(dropdownChildren, triggerElm, _instance) {\n  var menuItems = ref(null);\n  var menuItemsArray = ref(null);\n  var dropdownElm = ref(null);\n  var listId = ref(\"dropdown-menu-\".concat(generateId()));\n  dropdownElm.value = dropdownChildren == null ? void 0 : dropdownChildren.subTree.el;\n\n  function removeTabindex() {\n    var _a;\n\n    triggerElm.setAttribute(\"tabindex\", \"-1\");\n    (_a = menuItemsArray.value) == null ? void 0 : _a.forEach(function (item) {\n      item.setAttribute(\"tabindex\", \"-1\");\n    });\n  }\n\n  function resetTabindex(ele) {\n    removeTabindex();\n    ele == null ? void 0 : ele.setAttribute(\"tabindex\", \"0\");\n  }\n\n  function handleTriggerKeyDown(ev) {\n    var code = ev.code;\n\n    if ([EVENT_CODE.up, EVENT_CODE.down].includes(code)) {\n      removeTabindex();\n      resetTabindex(menuItems.value[0]);\n      menuItems.value[0].focus();\n      ev.preventDefault();\n      ev.stopPropagation();\n    } else if (code === EVENT_CODE.enter) {\n      _instance.handleClick();\n    } else if ([EVENT_CODE.tab, EVENT_CODE.esc].includes(code)) {\n      _instance.hide();\n    }\n  }\n\n  function handleItemKeyDown(ev) {\n    var code = ev.code;\n    var target = ev.target;\n    var currentIndex = menuItemsArray.value.indexOf(target);\n    var max = menuItemsArray.value.length - 1;\n    var nextIndex;\n\n    if ([EVENT_CODE.up, EVENT_CODE.down].includes(code)) {\n      if (code === EVENT_CODE.up) {\n        nextIndex = currentIndex !== 0 ? currentIndex - 1 : 0;\n      } else {\n        nextIndex = currentIndex < max ? currentIndex + 1 : max;\n      }\n\n      removeTabindex();\n      resetTabindex(menuItems.value[nextIndex]);\n      menuItems.value[nextIndex].focus();\n      ev.preventDefault();\n      ev.stopPropagation();\n    } else if (code === EVENT_CODE.enter) {\n      triggerElmFocus();\n      target.click();\n\n      if (_instance.props.hideOnClick) {\n        _instance.hide();\n      }\n    } else if ([EVENT_CODE.tab, EVENT_CODE.esc].includes(code)) {\n      _instance.hide();\n\n      triggerElmFocus();\n    }\n  }\n\n  function initAria() {\n    dropdownElm.value.setAttribute(\"id\", listId.value);\n    triggerElm.setAttribute(\"aria-haspopup\", \"list\");\n    triggerElm.setAttribute(\"aria-controls\", listId.value);\n\n    if (!_instance.props.splitButton) {\n      triggerElm.setAttribute(\"role\", \"button\");\n      triggerElm.setAttribute(\"tabindex\", _instance.props.tabindex);\n      addClass(triggerElm, \"el-dropdown-selfdefine\");\n    }\n  }\n\n  function initEvent() {\n    on(triggerElm, \"keydown\", handleTriggerKeyDown);\n    on(dropdownElm.value, \"keydown\", handleItemKeyDown, true);\n  }\n\n  function initDomOperation() {\n    menuItems.value = dropdownElm.value.querySelectorAll(\"[tabindex='-1']\");\n    menuItemsArray.value = [].slice.call(menuItems.value);\n    initEvent();\n    initAria();\n  }\n\n  function triggerElmFocus() {\n    triggerElm.focus();\n  }\n\n  initDomOperation();\n};\n\nexport { initDropdownDomEvent, useDropdown };","map":null,"metadata":{},"sourceType":"module"}