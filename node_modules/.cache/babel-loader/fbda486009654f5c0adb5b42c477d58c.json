{"ast":null,"code":"import { defineComponent, ref, computed } from 'vue';\nimport dayjs from 'dayjs';\nimport '../../../../hooks/index.mjs';\nimport '../../../time-picker/index.mjs';\nimport { hasClass } from '../../../../utils/dom.mjs';\nimport { coerceTruthyValueToArray } from '../../../../utils/util.mjs';\nimport { rangeArr } from '../../../time-picker/src/common/date-utils.mjs';\nimport { useLocaleInject } from '../../../../hooks/use-locale/index.mjs';\n\nvar datesInMonth = function datesInMonth(year, month, lang) {\n  var firstDay = dayjs().locale(lang).startOf(\"month\").month(month).year(year);\n  var numOfDays = firstDay.daysInMonth();\n  return rangeArr(numOfDays).map(function (n) {\n    return firstDay.add(n, \"day\").toDate();\n  });\n};\n\nvar script = defineComponent({\n  props: {\n    disabledDate: {\n      type: Function\n    },\n    selectionMode: {\n      type: String,\n      \"default\": \"month\"\n    },\n    minDate: {\n      type: Object\n    },\n    maxDate: {\n      type: Object\n    },\n    date: {\n      type: Object\n    },\n    parsedValue: {\n      type: Object\n    },\n    rangeState: {\n      type: Object,\n      \"default\": function _default() {\n        return {\n          endDate: null,\n          selecting: false\n        };\n      }\n    }\n  },\n  emits: [\"changerange\", \"pick\", \"select\"],\n  setup: function setup(props, ctx) {\n    var _useLocaleInject = useLocaleInject(),\n        t = _useLocaleInject.t,\n        lang = _useLocaleInject.lang;\n\n    var months = ref(props.date.locale(\"en\").localeData().monthsShort().map(function (_) {\n      return _.toLowerCase();\n    }));\n    var tableRows = ref([[], [], []]);\n    var lastRow = ref(null);\n    var lastColumn = ref(null);\n    var rows = computed(function () {\n      var _a;\n\n      var rows2 = tableRows.value;\n      var now = dayjs().locale(lang.value).startOf(\"month\");\n\n      for (var i = 0; i < 3; i++) {\n        var row = rows2[i];\n\n        for (var j = 0; j < 4; j++) {\n          var cell = row[j];\n\n          if (!cell) {\n            cell = {\n              row: i,\n              column: j,\n              type: \"normal\",\n              inRange: false,\n              start: false,\n              end: false\n            };\n          }\n\n          cell.type = \"normal\";\n          var index = i * 4 + j;\n          var calTime = props.date.startOf(\"year\").month(index);\n          var calEndDate = props.rangeState.endDate || props.maxDate || props.rangeState.selecting && props.minDate;\n          cell.inRange = props.minDate && calTime.isSameOrAfter(props.minDate, \"month\") && calEndDate && calTime.isSameOrBefore(calEndDate, \"month\") || props.minDate && calTime.isSameOrBefore(props.minDate, \"month\") && calEndDate && calTime.isSameOrAfter(calEndDate, \"month\");\n\n          if ((_a = props.minDate) == null ? void 0 : _a.isSameOrAfter(calEndDate)) {\n            cell.start = calEndDate && calTime.isSame(calEndDate, \"month\");\n            cell.end = props.minDate && calTime.isSame(props.minDate, \"month\");\n          } else {\n            cell.start = props.minDate && calTime.isSame(props.minDate, \"month\");\n            cell.end = calEndDate && calTime.isSame(calEndDate, \"month\");\n          }\n\n          var isToday = now.isSame(calTime);\n\n          if (isToday) {\n            cell.type = \"today\";\n          }\n\n          cell.text = index;\n          var cellDate = calTime.toDate();\n          cell.disabled = props.disabledDate && props.disabledDate(cellDate);\n          row[j] = cell;\n        }\n      }\n\n      return rows2;\n    });\n\n    var getCellStyle = function getCellStyle(cell) {\n      var style = {};\n      var year = props.date.year();\n      var today = new Date();\n      var month = cell.text;\n      style.disabled = props.disabledDate ? datesInMonth(year, month, lang.value).every(props.disabledDate) : false;\n      style.current = coerceTruthyValueToArray(props.parsedValue).findIndex(function (date) {\n        return date.year() === year && date.month() === month;\n      }) >= 0;\n      style.today = today.getFullYear() === year && today.getMonth() === month;\n\n      if (cell.inRange) {\n        style[\"in-range\"] = true;\n\n        if (cell.start) {\n          style[\"start-date\"] = true;\n        }\n\n        if (cell.end) {\n          style[\"end-date\"] = true;\n        }\n      }\n\n      return style;\n    };\n\n    var handleMouseMove = function handleMouseMove(event) {\n      if (!props.rangeState.selecting) return;\n      var target = event.target;\n\n      if (target.tagName === \"A\") {\n        target = target.parentNode.parentNode;\n      }\n\n      if (target.tagName === \"DIV\") {\n        target = target.parentNode;\n      }\n\n      if (target.tagName !== \"TD\") return;\n      var row = target.parentNode.rowIndex;\n      var column = target.cellIndex;\n      if (rows.value[row][column].disabled) return;\n\n      if (row !== lastRow.value || column !== lastColumn.value) {\n        lastRow.value = row;\n        lastColumn.value = column;\n        ctx.emit(\"changerange\", {\n          selecting: true,\n          endDate: props.date.startOf(\"year\").month(row * 4 + column)\n        });\n      }\n    };\n\n    var handleMonthTableClick = function handleMonthTableClick(event) {\n      var target = event.target;\n\n      if (target.tagName === \"A\") {\n        target = target.parentNode.parentNode;\n      }\n\n      if (target.tagName === \"DIV\") {\n        target = target.parentNode;\n      }\n\n      if (target.tagName !== \"TD\") return;\n      if (hasClass(target, \"disabled\")) return;\n      var column = target.cellIndex;\n      var row = target.parentNode.rowIndex;\n      var month = row * 4 + column;\n      var newDate = props.date.startOf(\"year\").month(month);\n\n      if (props.selectionMode === \"range\") {\n        if (!props.rangeState.selecting) {\n          ctx.emit(\"pick\", {\n            minDate: newDate,\n            maxDate: null\n          });\n          ctx.emit(\"select\", true);\n        } else {\n          if (newDate >= props.minDate) {\n            ctx.emit(\"pick\", {\n              minDate: props.minDate,\n              maxDate: newDate\n            });\n          } else {\n            ctx.emit(\"pick\", {\n              minDate: newDate,\n              maxDate: props.minDate\n            });\n          }\n\n          ctx.emit(\"select\", false);\n        }\n      } else {\n        ctx.emit(\"pick\", month);\n      }\n    };\n\n    return {\n      handleMouseMove: handleMouseMove,\n      handleMonthTableClick: handleMonthTableClick,\n      rows: rows,\n      getCellStyle: getCellStyle,\n      t: t,\n      months: months\n    };\n  }\n});\nexport { script as default };","map":null,"metadata":{},"sourceType":"module"}